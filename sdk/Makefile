ifeq (,$(wildcard .env))
    $(error .env file not found)
else
    include .env
    export $(shell sed 's/=.*//' .env)
endif

test:
	@echo "Starting test task..."

	@echo ""
	@echo "Step 1: Installing dependencies..."
	@echo "----------------------------------------------------"
	@pip install . > /dev/null || { echo "âŒ pip install failed"; exit 1; }
	@echo "âœ… Dependencies installed successfully."

	@echo ""
	@echo "Step 2: Cleaning up old cache files..."
	@echo "----------------------------------------------------"
	@rm -f cache.db
	@echo "âœ… Cache cleared."

	@echo ""
	@echo "Step 3: Running integration tests..."
	@echo "----------------------------------------------------"
	@make run-integration-tests || { echo "âŒ Unit tests failed"; exit 1; }

	@echo ""
	@echo "ğŸ‰ All steps completed successfully!"

run-integration-tests:
	@echo "ğŸš€ Running reviews integration tests..."
	@python3 tests/integration/reviews.py || { echo "âŒ Tests failed"; exit 1; }
	@echo "âœ… Reviews tests completed successfully."
	@echo ""
	@echo "ğŸš€ Running intranet integration tests..."
	@python3 tests/integration/intranet.py || { echo "âŒ Tests failed"; exit 1; }
	@echo "âœ… Intranet tests completed successfully."
	@echo ""
	@echo "ğŸš€ Running sat integration tests..."
	@python3 tests/integration/sat.py || { echo "âŒ Tests failed"; exit 1; }
	@echo "âœ… SAT tests completed successfully."
